/* MIT License https://github.com/isabo/DubStash/blob/master/LICENSE | Copyright (c) 2013 Itzy Sabo */(function() {var j=!0,n=null,p=!1;
(function(){function q(a,b,c){this.i=a;this.b=b;this.f=c}function m(a){this.e=a;this.h=[]}function l(a){this.e=a;this.z=p;this.t=[];this.r=[]}function s(a,b,c){this.e=a;this.A=b;this.q=c}function h(a){this.g=a}function f(a){this.g=a;this.U=p;this.a=[];this.s=0;this.j=[]}var r={VERSION:"1.0.0.rc4",compile:function(a){return(new f(a)).c()},precompile:function(a){return(new f(a)).d()},createContext:function(a,b,c){return new q(a,b,c)}};f.prototype.c=function(){this.v();var a=this.T();return function(b,
c,d){return e.F(a,b,c,d)}};f.prototype.d=function(){this.v();return["function(d, i){","\tvar r = ["+this.S().toString()+"];","\treturn DubStash.Runtime.renderTemplate(r, d, i);\n}"].join("\n")};f.prototype.T=function(){var a=[],b;for(b in this.j)a.push(this.j[b].c());return a};f.prototype.S=function(){var a=[],b;for(b in this.j)a.push(this.j[b].d());return a};f.prototype.v=function(){if(!this.U){f.k.lastIndex=0;for(var a;(a=f.k.exec(this.g))!==n;)if(a[1].length===a[4].length){var b;this.m(a);switch(a[2]){case "if":a[3]?
(a=new l(a[3]),this.l(a),this.a.push(a)):console.log("Bad condition: "+a[0]);break;case "foreach":a[3]&&(a=new m(a[3]),this.l(a),this.a.push(a));break;case "else":b=p;if(this.a.length){var c=this.a[this.a.length-1];c instanceof l?c.Q():b=j}else b=j;b&&(this.m(a[0]),console.log("Unexpected {{else}} encountered!"));break;case "end":b=p;this.a.length?a[3]&&(c=this.a[this.a.length-1],b="if"===a[3]?!(c instanceof l):"foreach"===a[3]?!(c instanceof m):j):b=j;b?(this.m(a[0]),console.log("Unexpected {{end}} encountered!")):
this.a.pop();break;default:a=new s(a[2],"/r"===a[3],2===a[1].length),this.l(a)}}else console.log("Unbalanced brackets encountered: "+a[0]);a=[];a.index=this.g.length;this.m(a);this.a.length&&console.log("Missing {{end}}!")}};f.prototype.m=function(a){a="string"===typeof a?a:this.g.slice(this.s,a.index);a.length?this.l(new h(a)):this.s=f.k.lastIndex};f.prototype.l=function(a){this.a.length?this.a[this.a.length-1].u(a):this.j.push(a);this.s=f.k.lastIndex};f.k=/({{2,3})\s*([^}\s]+)\s*([^}]*)?(}{2,3})/g;
h.prototype.c=function(){var a=this.g;return function(){return a}};h.prototype.d=function(){return["function(){",'\treturn "'+this.V(this.g)+'";',"}"].join("\n")};h.J=/"/g;h.M=/\r?\n/g;h.I=/\\/g;h.prototype.V=function(a){return a.replace(h.I,"\\\\").replace(h.J,'\\"').replace(h.M,"\\n")};s.prototype.c=function(){var a=this;return function(b,c){return e.D(a.e,a.A,a.q,b,c)}};s.prototype.d=function(){return["function(c, i){","\treturn DubStash.Runtime.renderPlaceHolderBlock("+['"'+this.e+'"',this.A,
this.q].join(", ")+", c, i);","}"].join("\n")};l.prototype.Q=function(){this.z=j};l.prototype.u=function(a){(this.z?this.r:this.t).push(a)};l.prototype.c=function(){var a=this.e,b=this.o(this.t),c=this.o(this.r);return function(d,g){return e.B(a,b,c,d,g)}};l.prototype.d=function(){return["function(c, i){",'\tvar n = "'+this.e+'";',"\tvar t = ["+this.n(this.t).toString()+"];","\tvar f = ["+this.n(this.r).toString()+"];","\treturn DubStash.Runtime.renderConditionBlock(n, t, f, c, i);\n}"].join("\n")};
l.prototype.o=function(a){var b=[],c;for(c in a)b.push(a[c].c());return b};l.prototype.n=function(a){var b=[],c;for(c in a)b.push(a[c].d());return b};m.prototype.c=function(){var a=this;return function(b,c){return e.C(a.e,a.o(),b,c)}};m.prototype.d=function(){return["function(c, i){",'\tvar n = "'+this.e+'";',"\tvar s = ["+this.n().toString()+"];","\treturn DubStash.Runtime.renderIteratorBlock(n, s, c, i);\n}"].join("\n")};m.prototype.u=function(a){this.h.push(a)};m.prototype.o=function(){var a=[],
b;for(b in this.h)a.push(this.h[b].c());return a};m.prototype.n=function(){var a=[],b;for(b in this.h)a.push(this.h[b].d());return a};var e={F:function(a,b,c,d){b=d||new q(b,"",b);d=[];for(var g in a)d.push(a[g].call(n,b,c));return d.join("")},D:function(a,b,c,d,g){var k=e.p(a,d);if(g&&void 0===k)return c?"{{"+a+"}}":"{{{"+a+"}}}";if(void 0===k||k===n)return"";a=c?e.q(""+k):""+k;b&&-1!==a.indexOf("{{")&&(a=this.O(a).call(n,d.f,g,d));return a},B:function(a,b,c,d,g){a=e.p(a,d)?b:c;b=[];for(var k in a)b.push(a[k].call(n,
d,g));return b.join("")},C:function(a,b,c,d){var g=e.p(a,c),k=[];if(g){a=c.b.length?c.b+"."+a:a;var f=new q(n,a+".[item]",c.f);this.P(g,function(a){for(var c in b)f.i=a,k.push(b[c].call(n,f,d))})}return k.join("")},O:function(a){var b;a&&(b=this.G[a]);b||(b=r.compile(a),this.G[a]=b);return b},G:{},p:function(a,b){b=this.R(a,b);b.name&&(a=b.name);for(var c=new q(b.i,b.b,b.f),d=a.split("."),g=d.length-1,e=0;e<g;e++){var f=this.w(c.i,d[e]);if(void 0!==f){var h=c.b?[c.b,d[e]].join("."):d[e];c.i=f;c.b=
h}else return}return this.w(c.i,d[g])},w:function(a,b){var c;if(a!==n){c="function"===typeof a[b]?a[b]():a[b];if("object"===typeof c){if(c instanceof Array)return c.length?c:n;for(var d in c)return c;return n}return c}},R:function(a,b){var c=a.split("../").length-1;if(c){var d=b.b.split("."),e=d.length-c-1;-1>e&&(console.log("Too many levels to climb from "+b.b+" to "+a+". Will stop at the top."),e=-1);-1!==e?(d=d.slice(0,e+1).join("."),e=this.p(d,new q(b.f,"",b.f))):(d="",e=b.f);d=new q(e,d,b.f);
d.name=a.slice(3*c);return d}return b},P:function(a,b){if("function"===typeof a.forEach)a.forEach(b);else if("function"===typeof a.__iterator__)for(var c=a.__iterator__(p),d=p;!d;){try{var e=c.next()}catch(f){d=j}d||b.call(this,e)}else if("object"===typeof a)for(c in a)b.call(this,a[c]);else b.call(this,a)},q:function(a){return a.replace(e.H,"&amp;").replace(e.L,"&lt;").replace(e.K,"&gt;").replace(e.N,"&quot;")},L:/</g,K:/>/g,H:/&/g,N:/\"/g};r.Runtime||(r.Runtime=e,e.renderTemplate=e.F,e.renderPlaceHolderBlock=
e.D,e.renderConditionBlock=e.B,e.renderIteratorBlock=e.C);this.DubStash=r;try{module.exports=r}catch(t){}})();})();
