/* MIT License https://github.com/isabo/DubStash/blob/master/LICENSE | Copyright (c) 2013 Itzy Sabo */(function() {var j=!0,m=null,n=!1;
(function(){function l(a){this.d=a;this.g=[]}function k(a){this.d=a;this.A=n;this.u=[];this.s=[]}function q(a,b,c){this.d=a;this.B=b;this.r=c}function h(a){this.f=a}function d(a){this.f=a;this.T=n;this.a=[];this.t=0;this.j=[]}var p={VERSION:"1.0.0.rc2",compile:function(a){return(new d(a)).b()},precompile:function(a){return(new d(a)).c()}};d.prototype.b=function(){this.w();var a=this.S();return function(b,c){return f.G(a,b,c)}};d.prototype.c=function(){this.w();return["function(d, i){","\tvar r = ["+
this.R().toString()+"];","\treturn DubStash.Runtime.renderTemplate(r, d, i);\n}"].join("\n")};d.prototype.S=function(){var a=[],b;for(b in this.j)a.push(this.j[b].b());return a};d.prototype.R=function(){var a=[],b;for(b in this.j)a.push(this.j[b].c());return a};d.prototype.w=function(){if(!this.T){d.k.lastIndex=0;for(var a;(a=d.k.exec(this.f))!==m;)if(a[1].length===a[4].length){var b;this.m(a);switch(a[2]){case "if":a[3]?(a=new k(a[3]),this.l(a),this.a.push(a)):console.log("Bad condition: "+a[0]);
break;case "foreach":a[3]&&(a=new l(a[3]),this.l(a),this.a.push(a));break;case "else":b=n;if(this.a.length){var c=this.a[this.a.length-1];c instanceof k?c.P():b=j}else b=j;b&&(this.m(a[0]),console.log("Unexpected {{else}} encountered!"));break;case "end":b=n;this.a.length?a[3]&&(c=this.a[this.a.length-1],b="if"===a[3]?!(c instanceof k):"foreach"===a[3]?!(c instanceof l):j):b=j;b?(this.m(a[0]),console.log("Unexpected {{end}} encountered!")):this.a.pop();break;default:a=new q(a[2],"/r"===a[3],2===a[1].length),
this.l(a)}}else console.log("Unbalanced brackets encountered: "+a[0]);a=[];a.index=this.f.length;this.m(a);this.a.length&&console.log("Missing {{end}}!")}};d.prototype.m=function(a){a="string"===typeof a?a:this.f.slice(this.t,a.index);a.length?this.l(new h(a)):this.t=d.k.lastIndex};d.prototype.l=function(a){this.a.length?this.a[this.a.length-1].v(a):this.j.push(a);this.t=d.k.lastIndex};d.k=/({{2,3})\s*([^}\s]+)\s*([^}]*)?(}{2,3})/g;h.prototype.b=function(){var a=this.f;return function(){return a}};
h.prototype.c=function(){return["function(){",'\treturn "'+this.U(this.f)+'";',"}"].join("\n")};h.J=/"/g;h.M=/\r?\n/g;h.I=/\\/g;h.prototype.U=function(a){return a.replace(h.I,"\\\\").replace(h.J,'\\"').replace(h.M,"\\n")};q.prototype.b=function(){var a=this;return function(b,c){return f.F(a.d,a.B,a.r,b,c)}};q.prototype.c=function(){return["function(c, i){","\treturn DubStash.Runtime.renderPlaceHolderBlock("+['"'+this.d+'"',this.B,this.r].join(", ")+", c, i);","}"].join("\n")};k.prototype.P=function(){this.A=
j};k.prototype.v=function(a){(this.A?this.s:this.u).push(a)};k.prototype.b=function(){var a=this.d,b=this.p(this.u),c=this.p(this.s);return function(e,g){return f.C(a,b,c,e,g)}};k.prototype.c=function(){return["function(c, i){",'\tvar n = "'+this.d+'";',"\tvar t = ["+this.o(this.u).toString()+"];","\tvar f = ["+this.o(this.s).toString()+"];","\treturn DubStash.Runtime.renderConditionBlock(n, t, f, c, i);\n}"].join("\n")};k.prototype.p=function(a){var b=[],c;for(c in a)b.push(a[c].b());return b};k.prototype.o=
function(a){var b=[],c;for(c in a)b.push(a[c].c());return b};l.prototype.b=function(){var a=this;return function(b,c){return f.D(a.d,a.p(),b,c)}};l.prototype.c=function(){return["function(c, i){",'\tvar n = "'+this.d+'";',"\tvar s = ["+this.o().toString()+"];","\treturn DubStash.Runtime.renderIteratorBlock(n, s, c, i);\n}"].join("\n")};l.prototype.v=function(a){this.g.push(a)};l.prototype.p=function(){var a=[],b;for(b in this.g)a.push(this.g[b].b());return a};l.prototype.o=function(){var a=[],b;for(b in this.g)a.push(this.g[b].c());
return a};var f={G:function(a,b,c){b=this.n(b,"",b);var e=[],g;for(g in a)e.push(a[g].call(m,b,c));return e.join("")},F:function(a,b,c,e,g){var d=f.q(a,e);if(g&&void 0===d)return c?"{{"+a+"}}":"{{{"+a+"}}}";if(void 0===d||d===m)return"";a=c?f.r(""+d):""+d;b&&-1!==a.indexOf("{{")&&(a=p.compile(a).call(m,e.h,g));return a},C:function(a,b,c,e,g){a=f.q(a,e)?b:c;b=[];for(var d in a)b.push(a[d].call(m,e,g));return b.join("")},D:function(a,b,c,e){var g=f.q(a,c),d=[];if(g){a=c.e.length?c.e+"."+a:a;var h=this.n(m,
a+".[item]",c.i);this.O(g,function(a){for(var c in b)h.h=a,d.push(b[c].call(m,h,e))})}return d.join("")},n:function(a,b,c){return{h:a,e:b,i:c}},q:function(a,b){b=this.Q(a,b);b.name&&(a=b.name);for(var c=a.split("."),e=c.length-1,g=0;g<e;g++){var d=this.z(b.h,c[g]);if(void 0!==d){var f=[b.e,c[g]].join(".");b.h=d;b.e=f}else return}return this.z(b.h,c[e])},z:function(a,b){var c;c="function"===typeof a[b]?a[b]():a[b];if("object"===typeof c){if(c instanceof Array)return c.length?c:m;for(var e in c)return c;
return m}return c},Q:function(a,b){var c=a.split("../").length-1;if(c){var e=b.e.split("."),d=e.length-c-1;-1>d&&(console.log("Too many levels to climb from "+b.e+" to "+a+". Will stop at the top."),d=-1);-1!==d?(e=e.slice(0,d+1).join("."),d=this.q(e,this.n(b.i,"",b.i))):(e="",d=b.i);e=this.n(d,e,b.i);e.name=a.slice(3*c);return e}return b},O:function(a,b){if("function"===typeof a.forEach)a.forEach(b);else if("function"===typeof a.__iterator__)for(var c=a.__iterator__(n),d=n;!d;){try{var f=c.next()}catch(h){d=
j}d||b.call(this,f)}else if("object"===typeof a)for(c in a)b.call(this,a[c]);else b.call(this,a)},r:function(a){return a.replace(f.H,"&amp;").replace(f.L,"&lt;").replace(f.K,"&gt;").replace(f.N,"&quot;")},L:/</g,K:/>/g,H:/&/g,N:/\"/g};p.Runtime||(p.Runtime=f,f.renderTemplate=f.G,f.renderPlaceHolderBlock=f.F,f.renderConditionBlock=f.C,f.renderIteratorBlock=f.D);this.DubStash=p;try{module.exports=p}catch(r){}})();})();
