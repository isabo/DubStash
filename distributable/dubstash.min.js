/* MIT License https://github.com/isabo/DubStash/blob/master/LICENSE | Copyright (c) 2013 Itzy Sabo */(function() {var j=!0,m=null,n=!1;
(function(){function p(a,b,c){this.o=a;this.c=b;this.b=c}function q(a){this.f=a;this.i=[]}function k(a,b){this.f=a;this.j=b;this.D=n;this.w=[];this.t=[]}function s(a,b,c){this.f=a;this.j=b;this.s=c}function h(a){this.h=a}function g(a){this.h=a;this.X=n;this.a=[];this.v=0;this.k=[]}var r={VERSION:"1.0.0.rc6",compile:function(a){return(new g(a)).d()},precompile:function(a){return(new g(a)).e()},registerGlobalTemplate:function(a,b){f.Z(a,r.compile(b))},registerGlobalData:function(a,b){f.registerGlobalData(a,
b)},createContext:function(a,b,c){return new p(a,b,c)}};g.prototype.d=function(){this.B();var a=this.W();return function(b,c,d){return f.J(a,b,c,d)}};g.prototype.e=function(){this.B();return["function(d, i, s){","\tvar r = ["+this.V().toString()+"];","\treturn DubStash.Runtime.renderTemplate(r, d, i, s);\n}"].join("\n")};g.prototype.W=function(){var a=[],b;for(b in this.k)a.push(this.k[b].d());return a};g.prototype.V=function(){var a=[],b;for(b in this.k)a.push(this.k[b].e());return a};g.prototype.B=
function(){if(!this.X){g.l.lastIndex=0;for(var a;(a=g.l.exec(this.h))!==m;)if(a[1].length===a[5].length){var b;this.n(a);switch(a[2]){case "if":a[3]?(b="/r"===a[4],a=new k(a[3],b),this.m(a),this.a.push(a)):console.log("Bad condition: "+a[0]);break;case "foreach":a[3]&&(a=new q(a[3]),this.m(a),this.a.push(a));break;case "else":b=n;if(this.a.length){var c=this.a[this.a.length-1];c instanceof k?c.T():b=j}else b=j;b&&(this.n(a[0]),console.log("Unexpected {{else}} encountered!"));break;case "end":b=n;
this.a.length?a[3]&&(c=this.a[this.a.length-1],b="if"===a[3]?!(c instanceof k):"foreach"===a[3]?!(c instanceof q):j):b=j;b?(this.n(a[0]),console.log("Unexpected {{end}} encountered!")):this.a.pop();break;default:c=2===a[1].length,b="/r"===a[3],a=new s(a[2],b,c),this.m(a)}}else console.log("Unbalanced brackets encountered: "+a[0]);a=[];a.index=this.h.length;this.n(a);this.a.length&&console.log("Missing {{end}}!")}};g.prototype.n=function(a){a="string"===typeof a?a:this.h.slice(this.v,a.index);a.length?
this.m(new h(a)):this.v=g.l.lastIndex};g.prototype.m=function(a){this.a.length?this.a[this.a.length-1].z(a):this.k.push(a);this.v=g.l.lastIndex};g.l=/(\{{2,3})\s*([^\}\s]*)\s*([^\}\s]*)?\s*([^\}\s]*)?(\}{2,3})/g;h.prototype.d=function(){var a=this.h;return function(){return a}};h.prototype.e=function(){return["function(){",'\treturn "'+this.Y(this.h)+'";',"}"].join("\n")};h.N=/"/g;h.Q=/\r?\n/g;h.M=/\\/g;h.prototype.Y=function(a){return a.replace(h.M,"\\\\").replace(h.N,'\\"').replace(h.Q,"\\n")};
s.prototype.d=function(){var a=this;return function(b,c){return f.I(a.f,a.j,a.s,b,c)}};s.prototype.e=function(){return["function(c, i){","\treturn DubStash.Runtime.renderPlaceHolderBlock("+['"'+this.f+'"',this.j,this.s].join(", ")+", c, i);","}"].join("\n")};k.prototype.T=function(){this.D=j};k.prototype.z=function(a){(this.D?this.t:this.w).push(a)};k.prototype.d=function(){var a=this.f,b=this.j,c=this.q(this.w),d=this.q(this.t);return function(e,l){return f.G(a,b,c,d,e,l)}};k.prototype.e=function(){return["function(c, i){",
'\tvar n = "'+this.f+'";',"\tvar r = "+this.j+";","\tvar t = ["+this.p(this.w).toString()+"];","\tvar f = ["+this.p(this.t).toString()+"];","\treturn DubStash.Runtime.renderConditionBlock(n, r, t, f, c, i);\n}"].join("\n")};k.prototype.q=function(a){var b=[],c;for(c in a)b.push(a[c].d());return b};k.prototype.p=function(a){var b=[],c;for(c in a)b.push(a[c].e());return b};q.prototype.d=function(){var a=this;return function(b,c){return f.H(a.f,a.q(),b,c)}};q.prototype.e=function(){return["function(c, i){",
'\tvar n = "'+this.f+'";',"\tvar s = ["+this.p().toString()+"];","\treturn DubStash.Runtime.renderIteratorBlock(n, s, c, i);\n}"].join("\n")};q.prototype.z=function(a){this.i.push(a)};q.prototype.q=function(){var a=[],b;for(b in this.i)a.push(this.i[b].d());return a};q.prototype.p=function(){var a=[],b;for(b in this.i)a.push(this.i[b].e());return a};var f={Z:function(a,b){this.F[a]=b},F:{},registerGlobalData:function(a,b){this.u[a]=b},u:{},J:function(a,b,c,d){b=d||new p(b,"",b);d=[];for(var e in a)d.push(a[e].call(m,
b,c));return d.join("")},I:function(a,b,c,d,e){var l=f.g(a,d);if(e&&void 0===l)return c?"{{"+a+"}}":"{{{"+a+"}}}";if(void 0===l||l===m)return"";a=c?f.s(""+l):""+l;b&&-1!==a.indexOf("{{")&&(a=this.A(a).call(m,d.b,e,d));return a},G:function(a,b,c,d,e,l){(a=f.g(a,e))&&(b&&"{{"===a.slice(0,2)&&"}}"===a.slice(-2))&&(a=this.A(a).call(m,e.b,n,e));b=a?c:d;c=[];for(var g in b)c.push(b[g].call(m,e,l));return c.join("")},H:function(a,b,c,d){var e=f.g(a,c),g=[];if(e){a=c.c.length?c.c+"."+a:a;var h=new p(m,a+
".[item]",c.b);this.S(e,function(a){for(var c in b)h.o=a,g.push(b[c].call(m,h,d))})}return g.join("")},A:function(a){var b;a&&(b=this.K[a]);b||(b=r.compile(a),this.K[a]=b);return b},K:{},g:function(a,b){b=this.U(a,b);if(b.name){a=b.name;var c=j}for(var d=new p(b.o,b.c,b.b),e=a.split("."),f=e.length-1,g=0;g<f;g++){var h=this.C(d,e[g]);if(void 0!==h){var k=d.c?[d.c,e[g]].join("."):e[g];d.o=h;d.c=k}else{if(b!==this.r&&!c)return this.g(a,this.r);return}}d=this.C(d,e[f]);b!==this.r&&(!c&&void 0===d)&&
(d=this.g(a,this.r));return d},C:function(a,b){var c=a.o,d;if(c!==m){b in c?d="function"===typeof c[b]?c[b]():c[b]:(c=this.F[b])&&(d=c.call(m,a.b,void 0,a));if("object"===typeof d){if(d instanceof Array)return d.length?d:m;for(var e in d)return d;return m}return d}},U:function(a,b){var c=a.split("../").length-1;if(c){var d=b.c.split("."),e=d.length-c-1;-1>e&&(console.log("Too many levels to climb from "+b.c+" to "+a+". Will stop at the top."),e=-1);-1!==e?(d=d.slice(0,e+1).join("."),e=this.g(d,new p(b.b,
"",b.b))):(d="",e=b.b);d=new p(e,d,b.b);d.name=a.slice(3*c);return d}return b},S:function(a,b){if("function"===typeof a.forEach)a.forEach(b);else if("function"===typeof a.__iterator__)for(var c=a.__iterator__(n),d=n;!d;){try{var e=c.next()}catch(f){d=j}d||b.call(this,e)}else if("object"===typeof a)for(c in a)b.call(this,a[c]);else b.call(this,a)},s:function(a){return a.replace(f.L,"&amp;").replace(f.P,"&lt;").replace(f.O,"&gt;").replace(f.R,"&quot;")},P:/</g,O:/>/g,L:/&/g,R:/\"/g};f.r=new p(f.u,"",
f.u);r.Runtime||(r.Runtime=f,f.renderTemplate=f.J,f.renderPlaceHolderBlock=f.I,f.renderConditionBlock=f.G,f.renderIteratorBlock=f.H);this.DubStash=r;try{module.exports=r}catch(t){}})();})();
