/* MIT License https://github.com/isabo/DubStash/blob/master/LICENSE | Copyright (c) 2013 Itzy Sabo */(function() {var h=!0,m=null,p=!1;
(function(){function q(a,b,c){this.n=a;this.c=b;this.b=c}function n(a){this.f=a;this.h=[]}function l(a,b){this.f=a;this.i=b;this.B=p;this.u=[];this.s=[]}function s(a,b,c){this.f=a;this.i=b;this.r=c}function j(a){this.g=a}function f(a){this.g=a;this.V=p;this.a=[];this.t=0;this.j=[]}var r={VERSION:"1.0.0.rc6",compile:function(a){return(new f(a)).d()},precompile:function(a){return(new f(a)).e()},registerGlobal:function(a,b){e.registerGlobal(a,r.compile(b))},createContext:function(a,b,c){return new q(a,
b,c)}};f.prototype.d=function(){this.z();var a=this.U();return function(b,c,d){return e.H(a,b,c,d)}};f.prototype.e=function(){this.z();return["function(d, i, s){","\tvar r = ["+this.T().toString()+"];","\treturn DubStash.Runtime.renderTemplate(r, d, i, s);\n}"].join("\n")};f.prototype.U=function(){var a=[],b;for(b in this.j)a.push(this.j[b].d());return a};f.prototype.T=function(){var a=[],b;for(b in this.j)a.push(this.j[b].e());return a};f.prototype.z=function(){if(!this.V){f.k.lastIndex=0;for(var a;(a=
f.k.exec(this.g))!==m;)if(a[1].length===a[5].length){var b;this.m(a);switch(a[2]){case "if":a[3]?(b="/r"===a[4],a=new l(a[3],b),this.l(a),this.a.push(a)):console.log("Bad condition: "+a[0]);break;case "foreach":a[3]&&(a=new n(a[3]),this.l(a),this.a.push(a));break;case "else":b=p;if(this.a.length){var c=this.a[this.a.length-1];c instanceof l?c.R():b=h}else b=h;b&&(this.m(a[0]),console.log("Unexpected {{else}} encountered!"));break;case "end":b=p;this.a.length?a[3]&&(c=this.a[this.a.length-1],b="if"===
a[3]?!(c instanceof l):"foreach"===a[3]?!(c instanceof n):h):b=h;b?(this.m(a[0]),console.log("Unexpected {{end}} encountered!")):this.a.pop();break;default:c=2===a[1].length,b="/r"===a[3],a=new s(a[2],b,c),this.l(a)}}else console.log("Unbalanced brackets encountered: "+a[0]);a=[];a.index=this.g.length;this.m(a);this.a.length&&console.log("Missing {{end}}!")}};f.prototype.m=function(a){a="string"===typeof a?a:this.g.slice(this.t,a.index);a.length?this.l(new j(a)):this.t=f.k.lastIndex};f.prototype.l=
function(a){this.a.length?this.a[this.a.length-1].v(a):this.j.push(a);this.t=f.k.lastIndex};f.k=/(\{{2,3})\s*([^\}\s]*)\s*([^\}\s]*)?\s*([^\}\s]*)?(\}{2,3})/g;j.prototype.d=function(){var a=this.g;return function(){return a}};j.prototype.e=function(){return["function(){",'\treturn "'+this.W(this.g)+'";',"}"].join("\n")};j.L=/"/g;j.O=/\r?\n/g;j.K=/\\/g;j.prototype.W=function(a){return a.replace(j.K,"\\\\").replace(j.L,'\\"').replace(j.O,"\\n")};s.prototype.d=function(){var a=this;return function(b,
c){return e.G(a.f,a.i,a.r,b,c)}};s.prototype.e=function(){return["function(c, i){","\treturn DubStash.Runtime.renderPlaceHolderBlock("+['"'+this.f+'"',this.i,this.r].join(", ")+", c, i);","}"].join("\n")};l.prototype.R=function(){this.B=h};l.prototype.v=function(a){(this.B?this.s:this.u).push(a)};l.prototype.d=function(){var a=this.f,b=this.i,c=this.p(this.u),d=this.p(this.s);return function(g,k){return e.D(a,b,c,d,g,k)}};l.prototype.e=function(){return["function(c, i){",'\tvar n = "'+this.f+'";',
"\tvar r = "+this.i+";","\tvar t = ["+this.o(this.u).toString()+"];","\tvar f = ["+this.o(this.s).toString()+"];","\treturn DubStash.Runtime.renderConditionBlock(n, r, t, f, c, i);\n}"].join("\n")};l.prototype.p=function(a){var b=[],c;for(c in a)b.push(a[c].d());return b};l.prototype.o=function(a){var b=[],c;for(c in a)b.push(a[c].e());return b};n.prototype.d=function(){var a=this;return function(b,c){return e.F(a.f,a.p(),b,c)}};n.prototype.e=function(){return["function(c, i){",'\tvar n = "'+this.f+
'";',"\tvar s = ["+this.o().toString()+"];","\treturn DubStash.Runtime.renderIteratorBlock(n, s, c, i);\n}"].join("\n")};n.prototype.v=function(a){this.h.push(a)};n.prototype.p=function(){var a=[],b;for(b in this.h)a.push(this.h[b].d());return a};n.prototype.o=function(){var a=[],b;for(b in this.h)a.push(this.h[b].e());return a};var e={registerGlobal:function(a,b){e.C[a]=b},C:{},H:function(a,b,c,d){b=d||new q(b,"",b);d=[];for(var g in a)d.push(a[g].call(m,b,c));return d.join("")},G:function(a,b,c,
d,g){var k=e.q(a,d);if(g&&void 0===k)return c?"{{"+a+"}}":"{{{"+a+"}}}";if(void 0===k||k===m)return"";a=c?e.r(""+k):""+k;b&&-1!==a.indexOf("{{")&&(a=this.w(a).call(m,d.b,g,d));return a},D:function(a,b,c,d,g,k){(a=e.q(a,g))&&(b&&"{{"===a.slice(0,2)&&"}}"===a.slice(-2))&&(a=this.w(a).call(m,g.b,p,g));b=a?c:d;c=[];for(var f in b)c.push(b[f].call(m,g,k));return c.join("")},F:function(a,b,c,d){var g=e.q(a,c),k=[];if(g){a=c.c.length?c.c+"."+a:a;var f=new q(m,a+".[item]",c.b);this.Q(g,function(a){for(var c in b)f.n=
a,k.push(b[c].call(m,f,d))})}return k.join("")},w:function(a){var b;a&&(b=this.I[a]);b||(b=r.compile(a),this.I[a]=b);return b},I:{},q:function(a,b){b=this.S(a,b);b.name&&(a=b.name);for(var c=new q(b.n,b.c,b.b),d=a.split("."),g=d.length-1,e=0;e<g;e++){var f=this.A(c,d[e]);if(void 0!==f){var j=c.c?[c.c,d[e]].join("."):d[e];c.n=f;c.c=j}else return}return this.A(c,d[g])},A:function(a,b){var c=a.n,d;if(c!==m){"function"===typeof c[b]?d=c[b]():b in c?d=c[b]:(c=e.C[b])&&(d=c.call(m,a.b,void 0,a));if("object"===
typeof d){if(d instanceof Array)return d.length?d:m;for(var g in d)return d;return m}return d}},S:function(a,b){var c=a.split("../").length-1;if(c){var d=b.c.split("."),e=d.length-c-1;-1>e&&(console.log("Too many levels to climb from "+b.c+" to "+a+". Will stop at the top."),e=-1);-1!==e?(d=d.slice(0,e+1).join("."),e=this.q(d,new q(b.b,"",b.b))):(d="",e=b.b);d=new q(e,d,b.b);d.name=a.slice(3*c);return d}return b},Q:function(a,b){if("function"===typeof a.forEach)a.forEach(b);else if("function"===typeof a.__iterator__)for(var c=
a.__iterator__(p),d=p;!d;){try{var e=c.next()}catch(f){d=h}d||b.call(this,e)}else if("object"===typeof a)for(c in a)b.call(this,a[c]);else b.call(this,a)},r:function(a){return a.replace(e.J,"&amp;").replace(e.N,"&lt;").replace(e.M,"&gt;").replace(e.P,"&quot;")},N:/</g,M:/>/g,J:/&/g,P:/\"/g};r.Runtime||(r.Runtime=e,e.renderTemplate=e.H,e.renderPlaceHolderBlock=e.G,e.renderConditionBlock=e.D,e.renderIteratorBlock=e.F);this.DubStash=r;try{module.exports=r}catch(t){}})();})();
