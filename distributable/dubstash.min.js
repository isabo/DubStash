/**
 * DubStash
 * Copyright (c) 2013 - 2015 Itzy Sabo
 * Licensed under the MIT License: https://github.com/isabo/DubStash/blob/master/LICENSE
 */
(function(){var h=this;function k(b,a){var c=b.split("."),d=h;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===a?d[e]?d=d[e]:d=d[e]={}:d[e]=a};function l(b){this.b=b}l.prototype.a=function(){var b=this;return function(){return b.b}};l.prototype.c=function(){return["function(){",'    return "'+this.b.replace(n,"\\\\").replace(p,'\\"').replace(q,"\\n")+'";',"}"].join("\n")};var p=/"/g,q=/\r?\n/g,n=/\\/g;l.prototype.f=function(){};function r(b,a,c){this.l=b;this.i=a;this.h=c};function t(){}t.a=function(){return t.c?t.c:t.c=new t};t.prototype.b={};t.prototype.c={};function u(b,a,c,d,e){b=e||new r(c,"",c);c=[];for(var f in a)c.push(a[f].call(null,b,d));return c.join("")}function v(b,a,c,d,e,f){var g=w(b,a,e);if(f&&void 0===g)return d?"{{"+a+"}}":"{{{"+a+"}}}";if(void 0===g||null===g)return"";a=d?(""+g).replace(x,"&amp;").replace(y,"&lt;").replace(z,"&gt;").replace(A,"&quot;"):""+g;c&&-1!==a.indexOf("{{")&&(a=B(b,a).call(null,e.h,f,e));return a}
function C(b,a,c,d,e,f,g){(a=w(b,a,f))&&c&&"{{"===a.slice(0,2)&&"}}"===a.slice(-2)&&(a=B(b,a).call(null,f.h,!1,f));b=a?d:e;c=[];for(var m in b)c.push(b[m].call(null,f,g));return c.join("")}function D(b,a,c,d,e){var f=w(b,a,d),g=[];if(f){a=d.i.length?d.i+"."+a:a;var m=new r(null,a+".[item]",d.h);E(b,f,function(a){for(var b in c)m.l=a,g.push(c[b].call(null,m,e))})}return g.join("")}function B(b,a){var c;a&&(c=b.f[a]);c||(c=F(a),b.f[a]=c);return c}t.prototype.f={};
function w(b,a,c){var d=a,e=c;if(c=d.split("../").length-1){var f=e.i.split("."),g=f.length-c-1;-1>g&&(console.log("Too many levels to climb from "+e.i+" to "+d+". Will stop at the top."),g=-1);-1!==g?(f=f.slice(0,g+1).join("."),g=w(b,f,new r(e.h,"",e.h))):(f="",g=e.h);e=new r(g,f,e.h);e.name=d.slice(3*c);c=e}else c=e;if(c.name){a=c.name;var m=!0}d=new r(c.l,c.i,c.h);e=a.split(".");f=e.length-1;for(g=0;g<f;g++){var G=H(b,d,e[g]);if(void 0!==G){var U=d.i?[d.i,e[g]].join("."):e[g];d.l=G;d.i=U}else return c===
b.a||m?void 0:w(b,a,b.a)}d=H(b,d,e[f]);c===b.a||m||void 0!==d||(d=w(b,a,b.a));return d}function H(b,a,c){var d=a.l,e;if(null!==d){c in d?e="function"===typeof d[c]?d[c]():d[c]:(b=b.b[c])&&(e=b.call(null,a.h,void 0,a));if("object"===typeof e){if(e instanceof Array)return e.length?e:null;for(var f in e)return e;return null}return e}}
function E(b,a,c){if("function"===typeof a.forEach)a.forEach(c);else if("function"===typeof a.s){a=a.s(!1);for(var d=!1;!d;){try{var e=a.next()}catch(f){d=!0}d||c.call(b,e)}}else if("object"===typeof a)for(d in a)c.call(b,a[d]);else c.call(b,a)}var y=/</g,z=/>/g,x=/&/g,A=/\"/g;t.prototype.a=new r(t.a().c,"",t.a().c);function I(b,a){this.m=b;this.j=a;this.o=!1;this.g=[];this.b=[]}I.prototype.f=function(b){(this.o?this.b:this.g).push(b)};I.prototype.a=function(){var b=this.m,a=this.j,c=J(this.g),d=J(this.b);return function(e,f){return C(t.a(),b,a,c,d,e,f)}};I.prototype.c=function(){return["function(c, i){",'    var n = "'+this.m+'";',"    var r = "+this.j+";","    var t = ["+K(this.g).toString()+"];","    var f = ["+K(this.b).toString()+"];","    return DubStash.C(n, r, t, f, c, i);\n}"].join("\n")};
function J(b){var a=[],c;for(c in b)a.push(b[c].a());return a}function K(b){var a=[],c;for(c in b)a.push(b[c].c());return a};function L(b){this.g=b;this.b=[]}L.prototype.a=function(){var b=this;return function(a,c){var d=t.a(),e=b.g,f=[],g;for(g in b.b)f.push(b.b[g].a());return D(d,e,f,a,c)}};L.prototype.c=function(){return["function(c, i){",'    var n = "'+this.g+'";',"    var s = ["+M(this).toString()+"];","    return DubStash.I(n, s, c, i);\n}"].join("\n")};L.prototype.f=function(b){this.b.push(b)};function M(b){var a=[],c;for(c in b.b)a.push(b.b[c].c());return a};function N(b,a,c){this.j=b;this.g=a;this.b=c}N.prototype.a=function(){var b=this;return function(a,c){return v(t.a(),b.j,b.g,b.b,a,c)}};N.prototype.c=function(){return["function(c, i){","    return DubStash.P("+['"'+this.j+'"',this.g,this.b].join(", ")+", c, i);","}"].join("\n")};N.prototype.f=function(){};function O(b){this.b=b;this.a=[];this.f=0;this.c=[]}function P(b){Q(b);var a=R(b);return function(b,d,e){return u(t.a(),a,b,d,e)}}function S(b){Q(b);var a=[],c;for(c in b.c)a.push(b.c[c].c());return["function(d, i, s){","    var r = ["+a.toString()+"];","    return DubStash.T(r, d, i, s);\n}"].join("\n")}function R(b){var a=[],c;for(c in b.c)a.push(b.c[c].a());return a}
function Q(b){T.lastIndex=0;for(var a;null!==(a=T.exec(b.b));)if(a[1].length===a[5].length){var c;V(b,a);switch(a[2]){case "if":a[3]?(c="/r"===a[4],a=new I(a[3],c),W(b,a),b.a.push(a)):console.log("Bad condition: "+a[0]);break;case "foreach":a[3]&&(a=new L(a[3]),W(b,a),b.a.push(a));break;case "else":c=!1;if(b.a.length){var d=b.a[b.a.length-1];d instanceof I?d.o=!0:c=!0}else c=!0;c&&(V(b,a[0]),console.log("Unexpected {{else}} encountered!"));break;case "end":c=!1;b.a.length?a[3]&&(d=b.a[b.a.length-
1],c="if"===a[3]?!(d instanceof I):"foreach"===a[3]?!(d instanceof L):!0):c=!0;c?(V(b,a[0]),console.log("Unexpected {{end}} encountered!")):b.a.pop();break;default:d=2===a[1].length,c="/r"===a[3],a=new N(a[2],c,d),W(b,a)}}else console.log("Unbalanced brackets encountered: "+a[0]);a=[];a.index=b.b.length;V(b,a);b.a.length&&console.log("Missing {{end}}!")}function V(b,a){var c="string"===typeof a?a:b.b.slice(b.f,a.index);c.length?W(b,new l(c)):b.f=T.lastIndex}
function W(b,a){b.a.length?b.a[b.a.length-1].f(a):b.c.push(a);b.f=T.lastIndex}var T=/(\{{2,3})\s*([^\}\s]*)\s*([^\}\s]*)?\s*([^\}\s]*)?(\}{2,3})/g;k("DubStash.VERSION","1.0.0");function F(b){return P(new O(b))}k("DubStash.compile",F);k("DubStash.precompile",function(b){return S(new O(b))});k("DubStash.registerGlobalTemplate",function(b,a){var c=t.a(),d=F(a);c.b[b]=d;X[b]=a});var X={};k("DubStash.precompileGlobalTemplates",function(){var b=[""],a;for(a in X)b.push("DubStash.G('"+a+"', "+S(new O(X[a]))+");");return b.join("\n")});k("DubStash.registerGlobalData",function(b,a){t.a().c[b]=a});
k("DubStash.createContext",function(b,a,c){return new r(b,a,c)});k("DubStash.G",function(b,a){t.a().b[b]=a});k("DubStash.T",function(b,a,c,d){return u(t.a(),b,a,c,d)});k("DubStash.P",function(b,a,c,d,e){return v(t.a(),b,a,c,d,e)});k("DubStash.C",function(b,a,c,d,e,f){return C(t.a(),b,a,c,d,e,f)});k("DubStash.I",function(b,a,c,d){return D(t.a(),b,a,c,d)});"undefined"!==typeof module&&module.exports&&(module.exports=h.DubStash);})();

