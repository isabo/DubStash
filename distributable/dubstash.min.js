/* MIT License https://github.com/isabo/DubStash/blob/master/LICENSE | Copyright (c) 2013 Itzy Sabo */(function() {var h=!0,l=null,m=!1;
(function(){function j(a){this.d=a;this.f=[]}function g(a){this.d=a;this.t=m;this.q=[];this.o=[]}function q(a,b,c){this.d=a;this.u=b;this.n=c}function f(a){this.e=a}function d(a){this.e=a;this.N=m;this.a=[];this.p=0;this.g=[]}var n={VERSION:"1.0.0.rc1",compile:function(a){return(new d(a)).b()},precompile:function(a){return(new d(a)).c()}};d.prototype.b=function(){this.s();var a=this.M();return function(b,c){return e.A(a,b,c)}};d.prototype.c=function(){this.s();return["function(d, i){","\tvar r = ["+
this.L().toString()+"];","\treturn DubStash.Runtime.renderTemplate(r, d, i);\n}"].join("\n")};d.prototype.M=function(){var a=[],b;for(b in this.g)a.push(this.g[b].b());return a};d.prototype.L=function(){var a=[],b;for(b in this.g)a.push(this.g[b].c());return a};d.prototype.s=function(){if(!this.N){d.h.lastIndex=0;for(var a;(a=d.h.exec(this.e))!==l;)if(a[1].length===a[4].length){var b;this.j(a);switch(a[2]){case "if":a[3]?(a=new g(a[3]),this.i(a),this.a.push(a)):p.log("Bad condition: "+a[0]);break;
case "foreach":a[3]&&(a=new j(a[3]),this.i(a),this.a.push(a));break;case "else":b=m;if(this.a.length){var c=this.a[this.a.length-1];c instanceof g?c.K():b=h}else b=h;b&&(this.j(a[0]),p.log("Unexpected {{else}} encountered!"));break;case "end":b=m;this.a.length?a[3]&&(c=this.a[this.a.length-1],b="if"===a[3]?!(c instanceof g):"foreach"===a[3]?!(c instanceof j):h):b=h;b?(this.j(a[0]),p.log("Unexpected {{end}} encountered!")):this.a.pop();break;default:a=new q(a[2],"/r"===a[3],2===a[1].length),this.i(a)}}else p.log("Unbalanced brackets encountered: "+
a[0]);a=[];a.index=this.e.length;this.j(a);this.a.length&&p.log("Missing {{end}}!")}};d.prototype.j=function(a){a="string"===typeof a?a:this.e.slice(this.p,a.index);a.length?this.i(new f(a)):this.p=d.h.lastIndex};d.prototype.i=function(a){this.a.length?this.a[this.a.length-1].r(a):this.g.push(a);this.p=d.h.lastIndex};d.h=/({{2,3})\s*([^}\s]+)\s*([^}]*)?(}{2,3})/g;f.prototype.b=function(){var a=this.e;return function(){return a}};f.prototype.c=function(){return["function(){",'\treturn "'+this.O(this.e)+
'";',"}"].join("\n")};f.D=/"/g;f.H=/\r?\n/g;f.C=/\\/g;f.prototype.O=function(a){return a.replace(f.C,"\\\\").replace(f.D,'\\"').replace(f.H,"\\n")};q.prototype.b=function(){var a=this;return function(b,c){return e.z(a.d,a.u,a.n,b,c)}};q.prototype.c=function(){return["function(d, i){","\treturn DubStash.Runtime.renderPlaceHolderBlock("+['"'+this.d+'"',this.u,this.n].join(", ")+", d, i);","}"].join("\n")};g.prototype.K=function(){this.t=h};g.prototype.r=function(a){(this.t?this.o:this.q).push(a)};g.prototype.b=
function(){var a=this.d,b=this.l(this.q),c=this.l(this.o);return function(r,d){return e.v(a,b,c,r,d)}};g.prototype.c=function(){return["function(d, i){",'\tvar n = "'+this.d+'";',"\tvar t = ["+this.k(this.q).toString()+"];","\tvar f = ["+this.k(this.o).toString()+"];","\treturn DubStash.Runtime.renderConditionBlock(n, t, f, d, i);\n}"].join("\n")};g.prototype.l=function(a){var b=[],c;for(c in a)b.push(a[c].b());return b};g.prototype.k=function(a){var b=[],c;for(c in a)b.push(a[c].c());return b};j.prototype.b=
function(){var a=this;return function(b,c){return e.w(a.d,a.l(),b,c)}};j.prototype.c=function(){return["function(d, i){",'\tvar n = "'+this.d+'";',"\tvar s = ["+this.k().toString()+"];","\treturn DubStash.Runtime.renderIteratorBlock(n, s, d, i);\n}"].join("\n")};j.prototype.r=function(a){this.f.push(a)};j.prototype.l=function(){var a=[],b;for(b in this.f)a.push(this.f[b].b());return a};j.prototype.k=function(){var a=[],b;for(b in this.f)a.push(this.f[b].c());return a};var e={A:function(a,b,c){var e=
[],d;for(d in a)e.push(a[d].call(l,b,c));return e.join("")},z:function(a,b,c,d,f){var k=e.m(a,d);if(f&&void 0===k)return c?"{{"+a+"}}":"{{{"+a+"}}}";if(void 0===k||k===l)return"";a=c?e.n(""+k):""+k;b&&-1!==a.indexOf("{{")&&(a=n.compile(a).call(l,d,f));return a},v:function(a,b,c,d,f){a=e.m(a,d)?b:c;b=[];for(var k in a)b.push(a[k].call(l,d,f));return b.join("")},w:function(a,b,c,d){a=e.m(a,c);var f=[];a&&this.J(a,function(a){for(var c in b)f.push(b[c].call(l,a,d))});return f.join("")},m:function(a,
b){var c=a.indexOf(".");if(0<c&&c<a.length-1){var d=a.slice(0,c);if(d in b)return e.m(a.slice(c+1),b[d])}else{c="function"===typeof b[a]?b[a]():b[a];if("object"===typeof c){if(c instanceof Array)return c.length?c:l;for(d in c)return c;return l}return c}},J:function(a,b){if("function"===typeof a.forEach)a.forEach(b);else if("function"===typeof a.__iterator__)for(var c=a.__iterator__(m),d=m;!d;){try{var e=c.next()}catch(f){d=h}d||b.call(this,e)}else if("object"===typeof a)for(c in a)b.call(this,a[c]);
else b.call(this,a)},n:function(a){return a.replace(e.B,"&amp;").replace(e.G,"&lt;").replace(e.F,"&gt;").replace(e.I,"&quot;")},G:/</g,F:/>/g,B:/&/g,I:/\"/g},p=function(){return this.console||console}();n.Runtime||(n.Runtime=e,e.renderTemplate=e.A,e.renderPlaceHolderBlock=e.z,e.renderConditionBlock=e.v,e.renderIteratorBlock=e.w);this.DubStash=n;try{module.exports=n}catch(s){}})();})();
